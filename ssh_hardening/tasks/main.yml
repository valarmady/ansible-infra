---
- name: deploy sshd config
  ansible.builtin.template:
    src: sshd_config.j2
    dest: /etc/ssh/sshd_config
    owner: root
    group: root
    mode: 0644
  notify: Restart SSH

- name: ensure .ssh exist for admin user
  ansible.builtin.file:
    path: '/home/{{ admin_user }}/.ssh'
    state: directory
    owner: '{{ admin_user }}'
    group: '{{ admin_user }}'
    mode: '0700'

- name: deploy authorized keys
  ansible.posix.authorized_key:
    user: '{{ admin_user }}'
    state: present
    key: '{{ item }}'
  with_items: '{{ ssh_authorized_keys }}'
